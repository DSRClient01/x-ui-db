# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è `x-ui`

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `x-ui`**, —É—Å—Ç—Ä–∞–Ω—è—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —É–ª—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –ø–∞–ø–∫–µ `/etc/x-ui/` –ø–æ—è–≤—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã, –∏ —ç—Ç–æ **–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**.

## üìå –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç** –≤ —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, `x-ui_optimize_db.py`.
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ —Å –ø—Ä–∞–≤–∞–º–∏ `root`**:
   ```bash
   sudo python3 x_ui_optimize_db.py
   ```

## üöÄ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç?

### 1Ô∏è‚É£ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å `x-ui`
```bash
systemctl stop x-ui
```
–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –≤–æ –≤—Ä–µ–º—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

### 2Ô∏è‚É£ –°–æ–∑–¥–∞—ë—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –≤ `/tmp/`
```bash
cp /etc/x-ui/x-ui.db /tmp/x-ui-<timestamp>.db
```
–§–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –ø–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```
/tmp/x-ui-1711045600.db
```
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏.

### 3Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é SQL-–∫–æ–º–∞–Ω–¥:

| **–ö–æ–º–∞–Ω–¥–∞ SQL** | **–û–ø–∏—Å–∞–Ω–∏–µ** |
|---------------|-------------|
| `PRAGMA journal_mode=WAL;` | –í–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º WAL (Write-Ahead Logging), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ**. –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –æ—à–∏–±–∫–∏ `database locked`. |
| `PRAGMA wal_checkpoint(TRUNCATE);` | –û—á–∏—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ WAL-—Ñ–∞–π–ª—ã, —Å–Ω–∏–∂–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –¥–∏—Å–∫. |
| `PRAGMA optimize;` | –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –∏ –∫—ç—à –±–∞–∑—ã, —É—Å–∫–æ—Ä—è—è —Ä–∞–±–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤. |
| `PRAGMA busy_timeout = 5000;` | –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—à–∏–±–∫–æ–π `database locked` (5000 –º—Å = 5 —Å–µ–∫—É–Ω–¥). |
| `PRAGMA read_uncommitted = 1;` | –ü–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–Ω–æ –º–æ–∂–µ—Ç –æ—Ç–¥–∞—Ç—å **–Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ** –¥–∞–Ω–Ω—ã–µ). |

### 4Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç `x-ui` –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```bash
systemctl restart x-ui
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±–∞–∑–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ.

## üìÇ –ü–æ—á–µ–º—É –ø–æ—è–≤–∏–ª–∏—Å—å —Ñ–∞–π–ª—ã `x-ui.db-shm` –∏ `x-ui.db-wal`?

–ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è WAL –≤ –ø–∞–ø–∫–µ `/etc/x-ui/` –ø–æ—è–≤–ª—è—é—Ç—Å—è **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã**:

| **–§–∞–π–ª** | **–û–ø–∏—Å–∞–Ω–∏–µ** |
|----------|-------------|
| `x-ui.db` | –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–∞–∑—ã SQLite. |
| `x-ui.db-wal` | –ñ—É—Ä–Ω–∞–ª WAL (Write-Ahead Logging), –≤ –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª. |
| `x-ui.db-shm` | –§–∞–π–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –¥–∞–Ω–Ω—ã–º (Shared Memory). |

**–≠—Ç–∏ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–æ–π.**

üìå **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ `x-ui.db-wal` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º, –º–æ–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å WAL –∫–æ–º–∞–Ω–¥–æ–π:
```sql
PRAGMA wal_checkpoint(TRUNCATE);
```

## ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫?

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å:
   ```bash
   systemctl stop x-ui
   ```  
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –∏–∑ –±—ç–∫–∞–ø–∞:
   ```bash
   cp /tmp/x-ui-<timestamp>.db /etc/x-ui/x-ui.db
   ```  
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:
   ```bash
   systemctl start x-ui
   ```
## –ö–æ–Ω—Ç–∞–∫—Ç—ã

Telegram: [@DSRClient](https://t.me/DSRCLIENT)
